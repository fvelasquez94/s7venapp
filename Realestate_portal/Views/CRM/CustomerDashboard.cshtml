@model Realestate_portal.Models.Tb_Customers

@{
    ViewBag.Title = "Dashboard CRM";
    List<Realestate_portal.Models.Tb_Process> listings = (List<Realestate_portal.Models.Tb_Process>)ViewBag.listings;
    List<Realestate_portal.Models.Tb_Docpackages> packages = (List<Realestate_portal.Models.Tb_Docpackages>)ViewBag.docpackages;
    List<Realestate_portal.Models.Tb_LeadDocs> lstotherdocs = (List<Realestate_portal.Models.Tb_LeadDocs>)ViewBag.otherDocs;
    List<Realestate_portal.Models.ViewModels.CRM.TeamsModel_Users> agents = (List<Realestate_portal.Models.ViewModels.CRM.TeamsModel_Users>)ViewBag.Agents;
    Realestate_portal.Models.Tb_WorkTeams team = (Realestate_portal.Models.Tb_WorkTeams)ViewBag.Team;
    List<Realestate_portal.Models.ViewModels.NotesView> lstnotes = (List<Realestate_portal.Models.ViewModels.NotesView>)ViewBag.notes;
    List<Realestate_portal.Models.Tb_Status> lststatus = (List<Realestate_portal.Models.Tb_Status>)ViewBag.lststatus;
    List<Realestate_portal.Models.Tb_Source> lstsource = (List<Realestate_portal.Models.Tb_Source>)ViewBag.lstsource;
    List<Realestate_portal.Models.Tb_Docpackages> lstdockpackages = (List<Realestate_portal.Models.Tb_Docpackages>)ViewBag.docpackages;
}
<div id="basic-non-sticky-notification-content" class="toastify-content hidden flex">
    <i class="text-theme-20" data-feather="check-circle"></i>
    <div class="ml-4 mr-4">
        <div class="font-medium">Data saved successfully!</div>

    </div>
</div>

        <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 xl:col-span-9 2xl:col-span-9 z-10">

                <div class="mt-14 mb-3 grid grid-cols-12 sm:gap-10 intro-y">
                    <div class="col-span-12 sm:col-span-6 md:col-span-4 py-6 sm:pl-5 md:pl-0 lg:pl-5 relative text-center sm:text-left">

                        <div class="text-sm 2xl:text-base font-medium -mb-1"> Lead Dashboard </div>
                        <div class="text-base 2xl:text-lg justify-center sm:justify-start flex items-center leading-3 mt-14 2xl:mt-24"> Projected Gains  </div>
                        <div class="2xl:flex mt-5 mb-3">
                            <div class="flex items-center justify-center sm:justify-start">
                                <div class="relative text-2xl 2xl:text-3xl font-medium leading-6 pl-3 2xl:pl-4"> <span class="absolute text-xl 2xl:text-2xl top-0 left-0 -mt-1 2xl:mt-0">$</span> @ViewBag.totalgainsprojected </div>

                            </div>
                            <div class="mt-5 2xl:flex 2xl:justify-center 2xl:mt-0 2xl:-ml-20 2xl:w-14 2xl:flex-none 2xl:pl-2.5">

                            </div>
                        </div>
                        <div class="flex flex-wrap gap-3">
                            <div class="mr-auto">
                                <div class=" text-opacity-70 flex items-center leading-3"> Gains  </div>
                                <div class="relative text-2xl font-medium leading-5 pl-4 mt-3.5"> <span class="absolute text-xl top-0 left-0 -mt-1.5">$</span> @ViewBag.totalgains </div>
                            </div>
                        </div>

                        @*<div class="mt-14 2xl:mt-24 dropdown">
                <button class="dropdown-toggle btn btn-rounded bg-theme-25 border-theme-25 text-white w-44 2xl:w-52 px-4 relative justify-start" aria-expanded="false">
                    Download Reports
                    <span class="w-8 h-8 absolute flex justify-center items-center right-0 top-0 bottom-0 my-auto ml-auto mr-1"> <i data-feather="chevron-down" class="w-4 h-4"></i> </span>
                </button>
                <div class="dropdown-menu w-44 2xl:w-52">
                    <div class="dropdown-menu__content box dark:bg-dark-1 p-2">
                        <a href="" class="flex items-center block p-2 transition duration-300 ease-in-out bg-white dark:bg-dark-1 hover:bg-gray-200 dark:hover:bg-dark-2 rounded-md"> <i data-feather="file-text" class="w-4 h-4 mr-2"></i> Annual Report </a>
                    </div>
                </div>
            </div>*@
                    </div>

                    <div class="col-span-12 sm:col-span-6 md:col-span-4 py-6 -ml-4 pl-4 md:ml-0 md:pl-0">
                        <div class="boxed-tabs nav nav-tabs justify-center w-3/4 2xl:w-4/6 bg-theme-27 text-white dark:bg-dark-2 dark:text-gray-500 rounded-md p-1 mx-auto" role="tablist"> <a data-toggle="tab" data-target="#active-users" href="javascript:;" class="btn flex-1 border-0 shadow-none py-1.5 px-2 active" id="active-users-tab" role="tab" aria-controls="active-users" aria-selected="true">Properties by Status</a> </div>
                        <div class="tab-content mt-6">
                            <div class="tab-pane active" id="active-users" role="tabpanel" aria-labelledby="active-users-tab">
                                <div class="relative">

                                    <div class="flex flex-col justify-center items-center absolute w-full h-full top-0 left-0">
                                        <div class=" text-xl 2xl:text-2xl font-medium">@listings.Count()</div>
                                        <div class=" mt-0.5">Total Properties</div>
                                    </div><br /><br />
                                </div>
                                <div class="mx-auto w-10/12 2xl:w-2/3 mt-8">
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-theme-25 rounded-full mr-3"></div>
                                        <span class=" truncate">LISTED</span>
                                        <div class="h-px flex-1 border border-r border-dashed border-gray-300 mx-3 xl:hidden"></div>
                                        <span class="font-medium xl:ml-auto">@listings.Where(c => c.Property == "LISTED").Count()</span>
                                    </div>
                                    <div class="flex items-center mt-4">
                                        <div class="w-2 h-2 bg-theme-15 rounded-full mr-3"></div>
                                        <span class=" truncate">PENDING</span>
                                        <div class="h-px flex-1 border border-r border-dashed border-gray-300 mx-3 xl:hidden"></div>
                                        <span class="font-medium xl:ml-auto">@listings.Where(c => c.Property == "PENDING").Count()</span>
                                    </div>
                                    <div class="flex items-center mt-4">
                                        <div class="w-2 h-2 bg-theme-20 rounded-full mr-3"></div>
                                        <span class="truncate">CLOSED</span>
                                        <div class="h-px flex-1 border border-r border-dashed border-gray-300 mx-3 xl:hidden"></div>
                                        <span class="font-medium xl:ml-auto">@listings.Where(c => c.Property == "CLOSED").Count()</span>
                                    </div>
                                    <div class="flex items-center mt-4">
                                        <div class="w-2 h-2 bg-theme-20 rounded-full mr-3"></div>
                                        <span class="truncate">RENTED</span>
                                        <div class="h-px flex-1 border border-r border-dashed border-gray-300 mx-3 xl:hidden"></div>
                                        <span class="font-medium xl:ml-auto">@listings.Where(c => c.Property == "RENTED").Count()</span>
                                    </div>     <div class="flex items-center mt-4">
                                        <div class="w-2 h-2 bg-theme-21 rounded-full mr-3"></div>
                                        <span class=" truncate">EXPIRED</span>
                                        <div class="h-px flex-1 border border-r border-dashed border-gray-300 mx-3 xl:hidden"></div>
                                        <span class="font-medium xl:ml-auto">@listings.Where(c => c.Property == "EXPIRED").Count()</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row-start-2 md:row-start-auto col-span-12 md:col-span-4 py-6  px-10 sm:px-28 md:px-5 -mx-5">
                        <div class="flex flex-wrap items-center">
                            @*<div class="flex items-center w-full sm:w-auto justify-center sm:justify-start mr-auto mb-5 2xl:mb-0">
                    <div class="w-2 h-2 bg-theme-24 rounded-full -mt-4"></div>
                    <div class="ml-3.5">
                        <div class=" mt-2">CLOSED vs ON CONTRACT</div>
                    </div>
                </div>*@

                        </div>
                        <div style="height:450px"></div>
                        @*<canvas class="mt-6" id="report-bar-chart-1" height="267"></canvas>*@
                    </div>
                </div>
            </div>
        </div>
 
    <div class="report-box-4 w-full h-full grid grid-cols-12 gap-6 xl:absolute -mt-8 xl:mt-0 pb-6 xl:pb-0 top-0 right-0 z-30 xl:z-auto">
        <div class="col-span-12 xl:col-span-3 xl:col-start-10 xl:pb-16 z-30">
            <div class="h-full flex flex-col">

                <div class="report-box-4__content xl:min-h-0 intro-x">
                    <div class="max-h-full xl:overflow-y-auto box mt-5">
                        <div class="bg-white dark:bg-dark-3 xl:sticky top-0 px-5 pt-5 pb-6">
                            <div class="flex items-center">

                                <div class="text-lg font-medium truncate mr-5">   <p data-letters="@Model.Name.Substring(0, 1) @Model.LastName.Substring(0, 1)">@Model.Name @Model.LastName </p></div>

                            </div>
                        </div>
                        <div class="tab-content px-5 pb-5">
                            <div class="tab-pane active grid grid-cols-12 gap-y-6" id="active-users" role="tabpanel" aria-labelledby="active-users-tab">
                                <div class="col-span-12 sm:col-span-6 md:col-span-4 xl:col-span-12">
                                    <div class="text-gray-600 dark:text-gray-500">Address</div>
                                    <div class="mt-1.5 flex items-center">
                                        @if (Model.Address == "")
                                        {<div class="text-lg"> - </div>

                                        }
                                        else { <div class="text-lg">@Model.Address</div>}

                                    </div>
                                </div>
                                <div class="col-span-12 sm:col-span-6 md:col-span-4 xl:col-span-12">
                                    <div class="text-gray-600 dark:text-gray-500">Telephone</div>
                                    <div class="mt-1.5 flex items-center">
                                        @if (Model.Phone == "")
                                        {
                                             <div class="text-lg"> - </div>
                                        }
                                        else {  <div class="text-lg">@Model.Phone</div>}</div>
                                </div>
                                <div class="col-span-12 sm:col-span-6 md:col-span-4 xl:col-span-12">
                                    <div class="text-gray-600 dark:text-gray-500">Email</div>
                                    <div class="mt-1.5 flex items-center">
                                        @if (Model.Email == "")
                                        {
                                            <div class="text-lg"> - </div>
                                        }
                                        else
                                        { <div class="text-lg">@Model.Email</div>}
                                    </div>
                                </div>
                                <div class="col-span-12 sm:col-span-6 md:col-span-4 xl:col-span-12">
                                    <div class="text-gray-600 dark:text-gray-500">Source</div>
                                    <div class="mt-1.5 flex items-center">

                                        @if (Model.Source == null || Model.Source=="")
    {<div class="text-lg"> - </div>}else{ <div class="text-lg">@Model.Source</div>}
                                    </div>
                                </div>
                                <div class="col-span-12 sm:col-span-6 md:col-span-4 xl:col-span-12">
                                    <div class="text-gray-600 dark:text-gray-500">Team</div>
                                    <div class="mt-1.5 flex items-center">

                                        @if (team.Name == null)
                                        {
                                            <div class="text-lg"> - </div>
                                        }
                                        else
                                        {
                                            if (team.Name == "")
                                            {
                                                <div class="text-lg"> - </div>
                                            }
                                            else
                                            {
                                                <div class="text-lg"> @team.Name </div>
                                            }
                                        }
                                    </div>
                                </div>
                                <div class="col-span-12 sm:col-span-6 md:col-span-4 xl:col-span-12">
                                    <div class="text-gray-600 dark:text-gray-500">Assigned Agents</div>
                                    <div class="flex ml-4">
                                        @if (agents.Count() > 0)
                                        {
                                            foreach (var agent in agents)
                                            {
                                                <div class="w-12 h-12 image-fit zoom-in -ml-4">
                                                    @if (agent.Url_image == "")
                                                    {
                                                        <img alt="@agent.Name" class="tooltip rounded-full" src="~/Content/dist/images/preview-11.jpg" title="@agent.Name">
                                                    }
                                                    else if (agent.Url_image.StartsWith("http"))
                                                    {
                                                        <img alt="@agent.Name" class="tooltip rounded-full" src="@agent.Url_image" title="@agent.Name">
                                                    }
                                                    else
                                                    {
                                                        <img alt="@agent.Name" class="tooltip rounded-full" src="@Url.Content(agent.Url_image)" title="@agent.Name">
                                                    }

                                                </div>
                                            }

                                        }
                                        else
                                        {
                                            <label>Not assigned</label>
                                        }
                                    </div>
                                </div>
                                <div class="col-span-12 sm:col-span-6 md:col-span-4 xl:col-span-12">
                                    <div class="text-gray-600 dark:text-gray-500">Stage</div>
                                    <div class="mt-1.5 flex items-center">
                                       
                                        <select id="stagecustomer" class="w-full form-control" >
                                            @foreach (var item in lststatus) {
                                                if (Model.Marital_status == item.Stage_name)
                                                {
                                                    <option selected>@item.Stage_name</option>
                                                }
                                                else {
                                                    <option>@item.Stage_name</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="intro-y box px-8 py-12" style="margin-top:130px">
        <h2 class="intro-y text-2xl font-medium text-center mr-auto"></h2>
        <!-- BEGIN: Pricing Tab -->
        <div class="intro-y flex justify-center mt-6">
            <div class="pricing-tabs nav nav-tabs box dark:bg-dark-1 rounded-full overflow-hidden" role="tablist">
                <a id="layout-2-monthly-fees-tab" data-toggle="tab" data-target="#layout-2-monthly-fees" href="javascript:;" class="flex-1 w-32 lg:w-40 py-2 lg:py-3 whitespace-nowrap text-center active" role="tab" aria-controls="layout-2-monthly-fees" aria-selected="true">Notes</a>
                <a id="layout-2-annual-fees-tab" data-toggle="tab" data-target="#layout-2-annual-fees" href="javascript:;" class="flex-1 w-32 lg:w-40 py-2 lg:py-3 whitespace-nowrap text-center" role="tab" aria-controls="layout-2-annual-fees" aria-selected="false">Properties</a>
                <a id="layout-3-annual-fees-tab" data-toggle="tab" data-target="#layout-3-annual-fees" href="javascript:;" class="flex-1 w-32 lg:w-40 py-2 lg:py-3 whitespace-nowrap text-center" role="tab" aria-controls="layout-2-annual-fees" aria-selected="false">Documents</a>
            </div>
        </div>
        <!-- END: Pricing Tab -->
        <!-- BEGIN: Pricing Content -->
        <div class="flex mt-10">
            <div class="tab-content">
                <div id="layout-2-monthly-fees" class="tab-pane  active" role="tabpanel" aria-labelledby="layout-2-monthly-fees-tab">
                    <div class="row">
                        <!-- BEGIN: Recent Activities -->
                        <div class="col-md-8">
                            <div class="intro-x flex items-center h-10">
                                <h2 class="text-lg font-medium truncate mr-5">
                                    Notes
                                </h2>
                                @if (ViewBag.rol == "SA")
                                {

                                }
                                else
                                {

                                    <a class="btn btn-success ml-auto  truncate" href="javascript:;" data-toggle="modal" data-target="#small-slide-over-size-preview">Add Note</a>
                                    <!-- BEGIN: Small Slide Over Content -->
                                    <div id="small-slide-over-size-preview" class="modal modal-slide-over" data-backdrop="static" tabindex="-1" aria-hidden="true">
                                        <div class="modal-dialog modal-sm">
                                            <div class="modal-content">
                                                @using (Html.BeginForm("Create", "Notes", FormMethod.Post))
                                                {
                                                    @Html.AntiForgeryToken()
                                                    <div class="modal-header p-5">
                                                        <h2 class="font-medium text-base mr-auto">
                                                            New Note
                                                        </h2>
                                                    </div>
                                                    <div class="modal-body">
                                                        <textarea class="form-control" id="Text" name="Text" required></textarea>
                                                        <input style="display:none" type="text" id="ID_Customer" name="ID_Customer" value="@Model.ID_Customer" />
                                                    </div>
                                                    <!-- BEGIN: Slide Over Footer -->
                                                    <div class="modal-footer text-right w-full absolute bottom-0">
                                                        <button type="button" data-dismiss="modal" class="btn btn-outline-secondary w-20 mr-1">Cancel</button>
                                                        <button type="submit" class="btn btn-success w-20">Save</button>
                                                    </div>
                                                    <!-- END: Slide Over Footer -->
                                                }
                                            </div>
                                        </div>
                                    </div>
                                    <!-- END: Small Slide Over Content -->
                                }
                            </div>
                            <div class="report-timeline mt-5 relative">
                                @if (lstnotes.Count > 0)
                                {
                                    foreach (var item in lstnotes.OrderByDescending(c => c.Date))
                                    {
                                        <div class="intro-x relative flex items-center mb-3">
                                            <div class="report-timeline__image">
                                                <div class="w-10 h-10 flex-none image-fit rounded-full overflow-hidden">
                                                    @if (item.Url_image == "")
    {
                                                <div class="tooltip text-lg  image-fit zoom-in font-medium truncate -ml-4" title="@item.Created_By">   <p data-letters="@item.Created_By.Substring(0, 2)"></p></div>
}
else if (item.Url_image.StartsWith("http"))
{
                                                <img alt="@item.Created_By" class="tooltip rounded-full" src="@item.Url_image" title="@item.Created_By">
}
else
{
                                                <img alt="@item.Created_By" class="tooltip rounded-full" src="@Url.Content(item.Url_image)" title="@item.Created_By">
}

                                                </div>
                                            </div>
                                            <div class="box px-5 py-3 ml-4 flex-1 zoom-in">
                                                <div class="flex items-center">
                                                    <div class="font-medium">@item.Created_By</div>
                                                    <div class="text-xs text-gray-500 ml-auto">@item.Date.ToLongDateString()</div>
                                                </div>
                                                <div class="text-gray-600 mt-1">@item.Text</div>
                                                <div class="flex items-center">

                                                    <a href="javascript:void(0)" onclick="deleteNote(@item.ID_note)" class="btn btn-sm btn-danger ml-auto">Delete</a>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                }
                                else
                                {
                                    <div class="sm:flex items-center">
                                        <img src="~/Content/dist/images/nodata-found.png" style="width:600px" />

                                        <div class="preview">

                                            <div class="alert alert-outline-secondary alert-dismissible show flex items-center mb-2" role="alert">
                                                <i data-feather="alert-octagon" class="w-6 h-6 mr-2"></i> Start adding a new Note

                                            </div>

                                        </div>
                                    </div>
                                }

                            </div>
                        </div>
                        <!-- END: Recent Activities -->


                        <div class="col-md-4 justify-center text-center">
                            <div class="font-medium text-lg">Notes</div>
                            <div class="mt-3 lg:text-justify text-gray-700 dark:text-gray-600" style="width:250px">
                                <p></p>

                            </div>
                        </div>
                    </div>
                </div>
                <div id="layout-2-annual-fees" class="tab-pane " role="tabpanel" aria-labelledby="layout-2-annual-fees-tab">
                    <div class="">
                        <div class="intro-y flex flex-col sm:flex-row items-center mt-8">
                            <h2 class="text-lg font-medium mr-auto">
                                Properties
                            </h2>
                            <div class="w-full sm:w-auto flex mt-4 sm:mt-0">
                                <a href="javascript:void(0);" class="btn btn-success shadow-md mr-2" data-toggle="modal" data-target="#propertywindow">Add New Property</a>

                            </div>
                        </div>

                        <!-- BEGIN: Blog Layout -->
                        @if (listings.Count > 0)
                        {
                            <div class="intro-y grid grid-cols-12 gap-6 mt-5">
                                @foreach (var item in listings)
                                {

                                    <div class="intro-y col-span-12 md:col-span-6 xl:col-span-4 box">
                                        <div class="flex items-center border-b border-gray-200 dark:border-dark-5 px-5 py-4">
                                            <div class="ml-3 mr-auto">
                                                <a href="" class="font-medium">@item.Address</a>
                                            </div>
                                            <div class="dropdown ml-3">
                                                <a href="javascript:;" class="dropdown-toggle w-5 h-5 text-gray-600 dark:text-gray-300" aria-expanded="false"> <i data-feather="more-vertical" class="w-4 h-4"></i> </a>
                                                <div class="dropdown-menu w-40">
                                                    <div class="dropdown-menu__content box dark:bg-dark-1 p-2">
                                                        <a href="@Url.Action("Edit","Properties", new { id=item.ID_Process})"  class="flex items-center block p-2 transition duration-300 ease-in-out bg-white dark:bg-dark-1 hover:bg-gray-200 dark:hover:bg-dark-2 rounded-md"> <i data-feather="edit-2" class="w-4 h-4 mr-2"></i> Edit Property </a>
                                                        @*<a href="javascript:void(0)" data-toggle="modal" data-target="#updatepropertywindow" class="flex items-center block p-2 transition duration-300 ease-in-out bg-white dark:bg-dark-1 hover:bg-gray-200 dark:hover:bg-dark-2 rounded-md"> <i data-feather="edit-2" class="w-4 h-4 mr-2"></i> Edit Property </a>*@
                                                        <a href="javascript:void(0)" onclick="deleteListing(@item.ID_Process)" class="flex items-center block p-2 transition duration-300 ease-in-out bg-white dark:bg-dark-1 hover:bg-gray-200 dark:hover:bg-dark-2 rounded-md"> <i data-feather="trash" class="w-4 h-4 mr-2"></i> Delete Property </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="p-5">
                                            <div class="h-40 2xl:h-56 image-fit">
                                                <img alt="S7VEN" class="rounded-md" src="~/Content/dist/images/noimageavailable.jpg" style="object-fit:contain">
                                            </div>
                                            <a href="" class="block font-medium text-base mt-5">Purchase price: $@item.Purchase_price</a>
                                        </div>

                                        <div class="px-5 pt-3 pb-5 border-t border-gray-200 dark:border-dark-5">
                                            <div class="w-full flex text-gray-600 text-xs sm:text-sm">
                                                <div class="mr-2"> Status: <span class="font-medium">@item.Property</span> </div>
                                                <div class="mr-2"> Stage: <span class="font-medium">@item.Stage</span> </div>

                                            </div>

                                        </div>
                                    </div>


                                }
                            </div>
                        }
                        else
                        {
                            <div class="col-md-12">
                                <div class="sm:flex items-center">
                                    <img src="~/Content/dist/images/nodata-found.png" style="width:600px" />

                                    <div class="preview">

                                        <div class="alert alert-outline-secondary alert-dismissible show flex items-center mb-2" role="alert">
                                            <i data-feather="alert-octagon" class="w-6 h-6 mr-2"></i> Start adding a new Property

                                        </div>

                                    </div>
                                </div>
                            </div>
                        }

                    </div>
                </div>
                <div id="layout-3-annual-fees" class="tab-pane" role="tabpanel" aria-labelledby="layout-3-annual-fees-tab">
                    <div class="">
                        <div class="intro-y flex flex-col sm:flex-row items-center mt-8">
                            <h2 class="text-lg font-medium mr-auto">
                                Other Documents
                            </h2>
                            <div class="w-full sm:w-auto flex mt-4 sm:mt-0">
  
                            </div>
                        </div>

                        <!-- BEGIN: Directory & Files -->


                        <div id="resourcesindividual" class="tab-pane flex flex-col lg:flex-row active" role="tabpanel" aria-labelledby="resourcesindividual">
                            <div class="col-span-12 lg:col-span-3 2xl:col-span-2">
              
                                <!-- BEGIN: File Manager Menu -->
                                <div class="intro-y box p-5 mt-6">
                                    <div class="mt-1">

                                        <div class="pricing-tabs nav nav-tabs box rounded-full overflow-hidden" role="tablist">
                                            <a id="layout-1-monthly-fees-tab" data-toggle="tab" data-target="#resourcesindividual2" href="javascript:;" class="flex-1 w-32 lg:w-40 py-2 lg:py-3 whitespace-nowrap text-center active" role="tab" aria-controls="layout-1-monthly-fees" aria-selected="true"> Other Documents</a>
                                            <a id="layout-1-annual-fees-tab" data-toggle="tab" data-target="#resourcesteam2" href="javascript:;" class="flex-1 w-32 lg:w-40 py-2 lg:py-3 whitespace-nowrap text-center" role="tab" aria-controls="layout-1-annual-fees" aria-selected="false"> Closing Documents</a>
                                        </div>

                                    </div>

                                </div>
                                <!-- END: File Manager Menu -->
                            </div>
                            <div class="col-span-12 lg:col-span-9 2xl:col-span-10 ml-5">

                                <div class="tab-content">
                                    <div id="resourcesindividual2" class="tab-pane active" role="tabpanel" aria-labelledby="resourcesindividual2">
                                        <div class="intro-y block sm:flex items-center h-10">
                                         
                                            <div class="row">
                                                <a href="javascript:void(0);" class="btn btn-success shadow-md mr-2" data-toggle="modal" data-target="#newDocument">Add New Document</a>
                                                <div id="newDocument" class="modal modal-slide-over" data-backdrop="static" tabindex="-1" aria-hidden="true">
                                                    <div class="modal-dialog modal-sm">
                                                        <div class="modal-content">
                                                            @using (Html.BeginForm("Create", "LeadDocs", FormMethod.Post))
                {
                                            @Html.AntiForgeryToken()
                                            <div class="modal-header p-5">
                                                <h2 class="font-medium text-base mr-auto">
                                                    New Document
                                                </h2>
                                            </div>
                                            <div class="modal-body">
                                                <label for="Title" class="form-label">Title</label>
                                                <div>
                                                    <input type="text" class="form-control" id="Title" name="Title" required />
                                                    <label for="Url" class="form-label">File</label>
                                                </div>
                                                <div>
                                                    <input type="text" class="form-control" id="Url" name="Url" required style="display:none" />
                                                    <input type="file" class="form-control documentfile" id="File" />
                                                </div>

                                                <label id="lblsuccessdoc"></label>
                                                <input style="display:none" type="text" id="Id_CustomerDoc" name="Id_CustomerDoc" value="@Model.ID_Customer" />
                                            </div>
                                            <!-- BEGIN: Slide Over Footer -->
                                            <div class="modal-footer text-right w-full absolute bottom-0">
                                                <button type="button" data-dismiss="modal" class="btn btn-outline-secondary w-20 mr-1">Cancel</button>
                                                <button type="submit" class="btn btn-success w-20">Save</button>
                                            </div>
                                            <!-- END: Slide Over Footer -->
}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        @if (lstotherdocs.Count() > 0)
    {
                                    <div class="intro-y grid grid-cols-12 gap-3 sm:gap-6 mt-5">

                                        @foreach (var item in lstotherdocs)
    {
                                    <div id="id_@item.Id_Document" class="intro-y col-span-6 sm:col-span-4 md:col-span-3 2xl:col-span-2 sortableDocs">
                                        <div class="file box rounded-md px-5 pt-8 pb-5 px-3 sm:px-5 relative zoom-in">

                                            @if (item.Extension == ".pdf")
        {
            if (item.Url.StartsWith("http"))
            {

                                    <a href="@item.Url" target="_blank" class="w-3/5 file__icon file__icon--image mx-auto">
                                        <div class="file__icon--image__preview image-fit">
                                            <img alt="S7VEN" src="~/Content/dist/images/preview-8.jpg">
                                        </div>
                                    </a>
                                    <a href="@item.Url" target="_blank" class="block font-medium mt-4 text-center truncate">@(item.Title + "" + item.Extension)</a>

}
else
{

                                    <a href="@Url.Action("Showpdflead", "CRM", new { id = item.Id_Document })" target="_blank" class="w-3/5 file__icon file__icon--image mx-auto">
                                        <div class="file__icon--image__preview image-fit">
                                            <img alt="S7VEN" src="~/Content/dist/images/preview-8.jpg">
                                        </div>
                                    </a>
                                    <a target="_blank" href="@Url.Action("Showpdflead", "CRM", new { id = item.Id_Document })" class="block font-medium mt-4 text-center truncate">@(item.Title + "" + item.Extension)</a>

}
}
else
{
if (item.Url.StartsWith("http"))
{

                                    <a href="@item.Url" target="_blank" class="w-3/5 file__icon file__icon--image mx-auto">
                                        <div class="file__icon--image__preview image-fit">
                                            <img alt="S7VEN" src="~/Content/dist/images/preview-8.jpg">
                                        </div>
                                    </a>
                                    <a href="@item.Url" target="_blank" class="block font-medium mt-4 text-center truncate">@(item.Title + "" + item.Extension)</a>

}
else
{

                                    <a href="@Url.Action("DownloadDoclead", "CRM", new { id = item.Id_Document })" target="_blank" class="w-3/5 file__icon file__icon--image mx-auto">
                                        <div class="file__icon--image__preview image-fit">
                                            <img alt="S7VEN" src="~/Content/dist/images/preview-8.jpg">
                                        </div>
                                    </a>
                                    <a href="@Url.Action("DownloadDoclead", "CRM", new { id = item.Id_Document })" class="block font-medium mt-4 text-center truncate">@(item.Title + "" + item.Extension)</a>
}

}

                                            <div class="text-gray-600 text-xs text-center mt-0.5">@item.Upload_Date.Value.ToShortDateString()</div>


                                        </div>
                                    </div>}
                                    </div>

}
else
{
                                    <div class="col-md-12">
                                        <div class="sm:flex items-center">
                                            <img src="~/Content/dist/images/nodata-found.png" style="width:600px" />

                                            <div class="preview">

                                                <div class="alert alert-outline-secondary alert-dismissible show flex items-center mb-2" role="alert">
                                                    <i data-feather="alert-octagon" class="w-6 h-6 mr-2"></i> Start adding a new Document

                                                </div>

                                            </div>
                                        </div>
                                    </div>


}
                                    </div>
                                    <div id="resourcesteam2" class="tab-pane" role="tabpanel" aria-labelledby="resourcesteam2">
                                        <div class="row">
                                            <a href="javascript:void(0)" class="btn btn-success" data-toggle="modal" data-target="#modalNewwebinar">Add Closing Package</a>

                                        </div>
                                        <div class="row">



                                            <div class="p-5" id="basic-table">
                                                <div class="preview">
                                                    <div class="overflow-x-auto">
                                                        <table class="table table-report sm:mt-2" id="tableresources">
                                                            <thead>
                                                                <tr class="text-white" style="background-color:#162343">
                                                                    <th class="whitespace-nowrap">
                                                                        PACKAGE ID
                                                                    </th>
                                                                    <th class="whitespace-nowrap">
                                                                        DESCRIPTION (Click to see details)
                                                                    </th>
                                                                    <th class="whitespace-nowrap">
                                                                        CATEGORY
                                                                    </th>

                                                                    <th class="whitespace-nowrap">
                                                                        PROPERTY ID
                                                                    </th>
                                                                    <th class="whitespace-nowrap">
                                                                        LAST UPDATE
                                                                    </th>
                                                                    <th class="whitespace-nowrap">
                                                                        TOTAL DOCUMENTS
                                                                    </th>
                                                                    <th class="whitespace-nowrap">
                                                                        STATUS
                                                                    </th>

                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                @foreach (var item in lstdockpackages)
                            {
                                    <tr>
                                        <td>@item.ID_docpackage</td>
                                        <td><a href="@Url.Action("Package_detailsCD","Portal", new { idpackage=item.ID_docpackage})" class="font-medium whitespace-nowrap"><i data-feather="link" class="w-4 h-4 mr-1"></i> @item.Description</a></td>
                                        <td>@item.Category</td>
                                        <td>@item.ID_Property</td>
                                        <td>@Convert.ToDateTime(item.Last_update).ToShortDateString()</td>
                                        <td>(@item.Total_docsf/@item.Total_docs)</td>
                                        <td>
                                            @if (item.Finished && item.Sent)
        {
                                    <label class="px-2 py-1 rounded-full bg-theme-20 text-white mr-1">COMPLETED</label>
}
else
{<label class="px-2 py-1 rounded-full bg-theme-15 mr-1">IN PROGRESS</label>}
                                        </td>


                                    </tr>
}
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>



                            </div>



                        <!-- END: Directory & Files -->
                    </div>

                </div>

            </div>

        </div>
    </div>
    <!-- END: Pricing Content -->
        <div id="modalNewwebinar" class="modal fade">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Add Closing Package</h4>

                    </div>
                    <form id="htmlform" method="post">
                        <div class="modal-body">
                            <div class="row">
                                @*<div class="col-7">
                                <div class="form-group">
                                    <label>Package Name *</label>
                                    <input type="text" class="form-control" id="title" placeholder="Name to identify easily your documents package" required />
                                </div>
                            </div>*@
                                <div class="col-12">
                                    <div class="form-group">
                                        <label>Category *</label>
                                        <select id="category" class="form-control" required>
                                            <option value="1">BUYER</option>
                                            <option value="3">SELLER</option>
                                            <option value="5">DUAL AGENCY</option>
                                            <option value="6">RENTAL LISTING</option>
                                            <option value="7">RENTAL TENANT</option>
                                            <option value="9">COMMERCIAL/INDUSTRIAL LISTING</option>
                                            <option value="11">LAND</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-12">
                                    <div class="form-group">
                                        <label>Property *</label>
                                        <select class="form-control w-full" name="ID_Property" id="ID_Property">
                                            @foreach (var item in listings)
    {
<option value="@item.ID_Process">@item.Description - @item.Address</option>
    }
                                        </select>
                                       
                                  

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-shadow" data-dismiss="modal">Close</button>
                            <button type="submit" id="subbtnenviar" class="btn btn-primary">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>


<!-- here stars edit property form modal section -->
<div aria-hidden="true" id="updatepropertywindow" tabindex="-1" role="dialog" aria-labelledby="closewindow" class="modal fade">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 id="closewindow">Edit property</h4>

            </div>
            <div class="modal-body">
                <!-- Begin Widget Body -->
                @using (Html.BeginForm("Edit", "Properties", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()
                    <div id="propertyform" class="widget-body">
                        <div class="form-horizontal">
                            <div class="row" style="text-align:center">
                                <div class="col-md-12">

                                </div>
                                <div class="col-md-12">
                                    <input type="hidden" name="ID_Customer" class="form-control" required />
                                    <label class="control-label">Customer :</label>
                                    <input class="form-control" type="text" disabled />
                                </div>
                                <div class="col-md-12">
                                    <label class="control-label">Status</label>
                                    <select class="form-control" name="Property">

                                        <option>LISTED</option>
                                        <option>PENDING</option>
                                        <option>CLOSED</option>
                                        <option>RENTED</option>
                                        <option>EXPIRED</option>

                                    </select>
                                </div>
                                <br />
                                <div class="col-md-12">
                                    <label class="control-label ">Address</label>
                                    <input type="text" name="Address" class="form-control" required />
                                </div>
                                <br />
                                <div class="col-md-12">
                                    <label class="control-label">Purchase Price ($)</label>
                                    <input type="number" step="0.01" name="Purchase_price" class="form-control" required />
                                </div>
                                <div class="col-md-12">
                                    <label class="control-label">Commission Amount ($)</label>
                                    <input type="number" step="0.01" name="Commission_amount" class="form-control" required
                                           oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" />
                                </div>
                                <div class="col-md-12">
                                    <label class="control-label">Commission Percentage (%)</label>
                                    <input type="number" step="0.01" name="Commissionperc" class="form-control" required
                                           oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" />
                                </div>
                                <input type="hidden" name="Stage" />
                                <div class="col-md-12">
                                    <label class="control-label">Stage</label>
                                    <input type="text" disabled name="Stage" class="form-control" required />
                                </div>
                                <div class="col-md-12">
                                    <label class="control-label"> Source</label>
                                    <input type="hidden" name="Source" />
                                    <input class="form-control" disabled name="Source" />
                                </div>
                                <br />
                                <div class="col-md-12">
                                    <label class="control-label"> Type of Agency</label>
                                    <select class="form-control" id="TypeofAgency" name="TypeofAgency">
                                        <option>NOT ASSIGNED</option>
                                        <option>BROKERS AGENT</option>
                                        <option>BUYERS AGENT</option>
                                        <option>SELLING AGENT</option>
                                        <option>DUAL AGENT</option>
                                        <option>LISTING AGENT</option>
                                    </select>
                                </div>
                                <br />
                                <br />
                                <div class="col-md-12">
                                    <label class="control-label">Loan Officer's Name</label>
                                    <input type="text" name="Loan_Officer_name" class="form-control" />
                                </div>
                                <br />
                                <div class="col-md-12">
                                    <label class="control-label">Loan Officer's Telephone</label>
                                    <input type="text" name="Loan_Officer_tel" class="form-control" />
                                </div>
                                <br />
                                <div class="col-md-12">
                                    <label class="control-label"> Attorney's Name</label>
                                    <input type="text" name="Attorneys_name" class="form-control" />
                                </div>
                                <br />
                                <div class="col-md-12">
                                    <label class="control-label"> Attorney's Telephone</label>
                                    <input type="text" name="Attorneys_tel" class="form-control" />
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group" style="position: relative !important; top:  20px !important;">
                                        <div class="col-md-offset-2 col-md-10">
                                            <input id="editpropertybtn" onclick="" type="submit" value="update" class="btn btn-outline-info" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }                                               <!-- End Widget -->
            </div>

            <div class="modal-footer">

                <button class="btn btn-outline-secondary" data-dismiss="modal" type="button">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- here ends edit property form modal section -->
<div aria-hidden="true" id="propertywindow" tabindex="-1" role="dialog" aria-labelledby="closewindow" class="modal fade">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 id="closewindow">Add Property</h4>

            </div>
            <!-- Begin Widget Body -->
            @using (Html.BeginForm("CreateProperty", "Properties", FormMethod.Post))
    {
        @Html.AntiForgeryToken()
        <div class="modal-body">

            <div id="propertyform" class="widget-body">
           
                  
                       
                            <label class="control-label">Description</label>
                            <input class="form-control" type="text" value="" id="Description" name="Description" />
                    

                     
                            <input type="hidden" name="ID_Customer" class="form-control" value="@Model.ID_Customer" required />
                        
                       
                     
                            <label class="control-label">Status</label>
                            <select class="form-control" name="Property">
                                <option>------</option>
                                <option selected>LISTED</option>
                                <option>PENDING</option>
                                <option>CLOSED</option>
                                <option>RENTED</option>
                                <option>EXPIRED</option>
                            </select>
                        
                        <br />
                      
                            <label class="control-label ">Address</label>
                            <input type="text" name="Address" class="form-control" required />
                        
                        <br />
                     
                            <label class="control-label">Purchase Price ($)</label>
                            <input type="number" step="0.01" name="Purchase_price" class="form-control" required
                                   oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" />
                        
                     
                            <label class="control-label">Commission Amount ($)</label>
                            <input type="number" step="0.01" name="Commission_amount" class="form-control" required
                                   oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" />
                   
                            <label class="control-label">Commission Percentage (%)</label>
                            <input type="number" step="0.01" name="Commissionperc" class="form-control" required
                                   oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" />
                    
                            <label class="control-label">Stage</label>
                            <select id="Stage" name="Stage" class="w-full form-control">
                                @foreach (var item in lststatus)
        {

                        <option>@item.Stage_name</option>

}
                            </select>
                      
                      
                       
                            <label class="control-label"> Source</label>
                            <select id="Stage" name="Source" class="w-full form-control">
                                @foreach (var item in lstsource)
        {

                        <option>@item.Source_name</option>

}
                            </select>
                        
                       
                        <br />
                       
                            <label class="control-label"> Type of Agency</label>
                            <select class="form-control" name="TypeofAgency">
                                <option>NOT ASSIGNED</option>
                                <option>BROKERS AGENT</option>
                                <option>BUYERS AGENT</option>
                                <option>SELLING AGENT</option>
                                <option>DUAL AGENT</option>
                                <option>LISTING AGENT</option>
                            </select>
                        
                        <br />
                        <br />
                    
                            <label class="control-label">Loan Officer's Name</label>
                            <input type="text" name="Loan_Officer_name" value="" class="form-control" />
                      
                        <br />
                      
                            <label class="control-label">Loan Officer's Telephone</label>
                            <input type="text" name="Loan_Officer_tel" value="" class="form-control" />
                     
                        <br />
                      
                            <label class="control-label"> Attorney's Name</label>
                            <input type="text" name="Attorneys_name" value="" class="form-control" />
                       
                        <br />
                      
                            <label class="control-label"> Attorney's Telephone</label>
                            <input type="text" name="Attorneys_tel" value="" class="form-control" />
                      

                
            </div>
            <!-- End Widget -->
        </div>

        <div class="modal-footer">
            <input onclick="" type="submit" value="Create" class="btn btn-primary" />
            <button type="button" data-dismiss="modal" class="btn btn-shadow">Close</button>

        </div>

}
        </div>
    </div>
</div>

<button id="basic-non-sticky-notification-toggle" style="display:none" class="btn btn-primary">Show Notification</button>

@if (ViewBag.token != null && ViewBag.token != "")
{
    if (ViewBag.token == "success")
    {
        <script>
            window.onload = function () {
                var link = document.getElementById('basic-non-sticky-notification-toggle');
                link.click();
            };


        </script>
    }

}

@section scripts{
    <script>
        function deleteNote(idnote) {

            swal.fire({
                title: 'Do you really want to delete these record?',
                text: "This process cannot be undone.",
                icon: 'error',
                showCancelButton: true,
                confirmButtonColor: '#C83232',
                cancelButtonColor: '#aaa',
                confirmButtonText: 'Delete'
            }).then((result) => {
                if (result.value) {
                    $.ajax({
                        url: '/Notes/DeleteNote',
                        type: 'POST',
                        data: { 'id': idnote },
                        cache: false,
                        global: false,
                        success: function (result) {
                            if (result == "Success") {
                                Swal.fire(
                                    'Record deleted',
                                    'The record has been deleted.',
                                    'success'
                                )
                                window.location.reload(false);
                            } else {
                                alert(result);
                            }


                        },
                        error: function (request) {
                            alert("Something went wrong.");

                        }
                    });


                }
            })
        }
        function deleteListing(idlisting) {
            
            swal.fire({
                title: 'Do you really want to delete these record?',
                text: "This process cannot be undone.",
                icon: 'error',
                showCancelButton: true,
                confirmButtonColor: '#C83232',
                cancelButtonColor: '#aaa',
                confirmButtonText: 'Delete'
            }).then((result) => {
                if (result.value) {
                    $.ajax({
                        url: '/Properties/DeleteConfirmed',
                        type: 'POST',
                        data: { 'id': idlisting },
                        cache: false,
                        global: false,
                        success: function (result) {
                            if (result == "Success") {
                                Swal.fire(
                                    'Record deleted',
                                    'The record has been deleted.',
                                    'success'
                                )
                                window.location.reload(false);
                            } else {
                                alert(result);
                            }


                        },
                        error: function (request) {
                            alert("Something went wrong.");

                        }
                    });

                }
            })
        }

        $('#htmlform').on('submit', function (event) {
            $("#subbtnenviar").attr("disabled", true);
            event.preventDefault();


            var formData = new FormData();

            var title = $("#ID_Property option:selected").html();//$("#title").val();
            var idcategory = $("#category").val();
            var customer = 0;
            var property = $('#ID_Property').val();
            var category = $("#category option:selected").html();

            if (property != "") {
                formData.append("title", title);
                formData.append("category", category);
                formData.append("customer", customer);
                formData.append("property", property);
                formData.append("idpackage", idcategory);

                $.ajax({
                    type: "POST",
                    url: '/Portal/newPackageClosing',
                    data: formData,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    success: function (response) {
                       
                        if (response.result == "SUCCESS") {
                          
                            $("#subbtnenviar").attr("disabled", false);

                            var link = document.getElementById('basic-non-sticky-notification-toggle');
                            link.click();
                            
                            window.location.href = "/Portal/Package_detailsCD?idpackage=" + response.idpackage;
                           
                        } else {
                            $("#preloader").hide();
                            $("#subbtnenviar").attr("disabled", false);
                            alert(response);
                        }
                    },
                    error: function (error) {
             
                        $("#subbtnenviar").attr("disabled", false);
                        alert("Error uploading package, select a valid Property");
                     
                    }
                });
            } else {
                alert("Select a valid Property")
            }


           
        });



        $(document).on("change", "#stagecustomer", function () {
            var stage = $(this).val();
            var id_customer = '@Model.ID_Customer';


            $.ajax({
                url: '/CRM/UpdateByAjaxSideBard',
                type: 'POST',
                datatype: 'application/json',
                contentType: 'application/json',
                data: JSON.stringify({
                    stage: stage,
                    id: id_customer

                }),
                success: function (result) {
                    var link = document.getElementById('basic-non-sticky-notification-toggle');
                    link.click();
                },
                error: function (err) {

                }
            });
        });
        $(document).on("change", ".documentfile", function () {
            var input = this;
            var url = $(this).val();

            var idurl = $("#Url");
            var idlbl = $("#lblsuccessdoc");

            var ext = url.substring(url.lastIndexOf('.') + 1).toLowerCase();
            if (input.files && input.files[0] && (ext == "pdf" || ext == "xlsx" || ext=="docx" || ext == "jpeg" || ext == "jpg")) {
                $("#lblsuccessdoc").html("<strong>Uploading file, please wait..<strong>");

                if ($("#Url").val() != "") { //eliminamos imagen anterior
                    try {
                        var filename = $("#Url").val();
                        filename = filename.replace("https://imagesproducts.blob.core.windows.net/sevenfiles/", "");


                        $.ajax({
                            url: '/LeadDocs/DeleteDocumentUploaded',
                            type: 'POST',
                            datatype: 'application/json',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                filename: filename

                            }),
                            success: function (result) {

                            },
                            error: function (err) {

                            }
                        });
                    } catch {

                    }

                }


                var data = new FormData();

                data.append("photo", input.files[0]);


                $.ajax({
                    url: '/LeadDocs/UploadNewDocument',
                    type: 'POST',
                    data: data,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    success: function (result) {

                        $("#Url").val(result);
                        $("#lblsuccessdoc").html("<strong>File uploaded successfully</strong>");

                    },
                    error: function (err) {
                        $("#Url").val("");
                        $("#lblsuccessdoc").html("<strong>Error uploading file, please try again<strong>");
                    }
                });

            }
            else {

            }
        });

    </script>
}



