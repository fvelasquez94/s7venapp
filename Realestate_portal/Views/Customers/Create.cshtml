@model Realestate_portal.Models.Tb_Customers
@using Realestate_portal.Models
@{
    ViewBag.Title = "Premium Group Realty";
    Layout = "~/Views/Shared/_CRM_Dashboard.cshtml";

    List<Sys_Users> agents = ViewBag.userslist;
    List<Tb_Source> source = ViewBag.lstSource;
    List<Tb_Status> m_status = ViewBag.lstStatus;

}
<link rel="stylesheet" href="~/Content/assetsEditor/css/line-awesome.min.css">
<div class="container-fluid">
    <!-- Begin Page Header-->
    <div class="row">
        <div class="page-header">
            <div class="d-flex align-items-center">
                <h2 class="page-header-title"></h2>
                <div>
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#"><i class="ti ti-home"></i></a></li>
                        <li class="breadcrumb-item active">CUSTOMERS</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- End Page Header -->
    <!-- Begin Widget 08 -->
    <div class="widget widget-08" style="width: 100%;background-color:transparent">



        <!-- Begin Widget -->
        <div class="widget has-shadow">

            <!-- End Widget Header -->
            <!-- Begin Widget Body -->
            <div class="widget-body" style="padding-bottom:250px">
                @using (Html.BeginForm())
                {
                    @Html.AntiForgeryToken()

                    <div class="form-horizontal">
                        <h4>ADD CUSTOMER</h4>
                        <hr />
                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                        <div class="row">

                            <div class="col-md-6">
                                @Html.LabelFor(model => model.Name, htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control", @required = "required" } })
                                @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })
                            </div>

                            <div class="col-md-6">
                                @Html.LabelFor(model => model.LastName, htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.EditorFor(model => model.LastName, new { htmlAttributes = new { @class = "form-control", @required = "required" } })
                                @Html.ValidationMessageFor(model => model.LastName, "", new { @class = "text-danger" })
                            </div>


                            <div class="col-md-6">
                                @Html.LabelFor(model => model.Birthday, htmlAttributes: new { @class = "control-label col-md-2" })
                                <input type="date" class="form-control" id="Birthday" name="Birthday" />
                            </div>

                            <div class="col-md-6" style="display:none;">
                                @Html.LabelFor(model => model.Gender, htmlAttributes: new { @class = "control-label col-md-2" })
                                <select class="form-control" name="Gender" id="Gender">
                                    <option selected>Male</option>
                                    <option>Female</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="control-label col-md-2">Status</label>
                                <select class="form-control" name="Marital_status" id="Marital_status">
                                    @foreach (var item in m_status)
                                    {
                                        <option value="@item.Stage_name">@item.Stage_name</option>
                                    }

                                </select>
                                <a class="la la-plus-circle la-2x" href="#" data-toggle="modal" data-target="#mstatusModal"></a>
                            </div>
                            <div class="col-md-6" style="margin-top:20px">
                                @Html.LabelFor(model => model.Type, htmlAttributes: new { @class = "control-label col-md-2" })
                                <select class="form-control" id="Type" name="Type">
                                    <option>NOT ASSIGNED</option>
                                    <option>BUYER</option>
                                    <option>INVESTOR</option>
                                    <option>LANDLORD</option>
                                    <option>RENTAL</option>
                                    <option>SELLER</option>
                                    <option>SHORT SALE</option>
                                    <option>TENANTS</option>


                                </select>
                            </div>

                            <div class="col-md-6" style="margin-top:20px">
                                @Html.LabelFor(model => model.Email, htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.EditorFor(model => model.Email, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.Email, "", new { @class = "text-danger" })
                            </div>

                            <div class="col-md-6" style="margin-top:20px">
                                @Html.LabelFor(model => model.Phone, htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.EditorFor(model => model.Phone, new { htmlAttributes = new { @class = "form-control", @required = "required" } })
                                @Html.ValidationMessageFor(model => model.Phone, "", new { @class = "text-danger" })
                            </div>

                            <div class="col-md-6" style="display:none;">
                                @Html.LabelFor(model => model.Mobile, htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.EditorFor(model => model.Mobile, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.Mobile, "", new { @class = "text-danger" })
                            </div>

                            <div class="col-md-6">
                                @Html.LabelFor(model => model.Address, htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.EditorFor(model => model.Address, new { htmlAttributes = new { @class = "form-control", @required = "required" } })
                                @Html.ValidationMessageFor(model => model.Address, "", new { @class = "text-danger" })
                            </div>
                            <div class="col-md-6">
                                @Html.LabelFor(model => model.State, htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.EditorFor(model => model.State, new { htmlAttributes = new { @class = "form-control", @required = "required" } })
                                @Html.ValidationMessageFor(model => model.State, "", new { @class = "text-danger" })
                            </div>
                            <div class="col-md-6">
                                @Html.LabelFor(model => model.City, htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.EditorFor(model => model.City, new { htmlAttributes = new { @class = "form-control", @required = "required" } })
                                @Html.ValidationMessageFor(model => model.City, "", new { @class = "text-danger" })
                            </div>
                            <div class="col-md-6">
                                @Html.LabelFor(model => model.Zipcode, htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.EditorFor(model => model.Zipcode, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.Zipcode, "", new { @class = "text-danger" })
                            </div>
                            <div class="col-md-6">
                                <label class="control-label"> Source</label>
                                <select class="form-control" name="Source" id="selectSource">
                                    @foreach (var item in source)
                                    {
                                        <option value="@item.Source_name">@item.Source_name</option>
                                    }
                                </select>
                                <a class="la la-plus-circle la-2x" href="#" data-toggle="modal" data-target="#sourceModal"></a>
                            </div>
                            <div class="col-md-6">
                                <label class="control-label">Agent Assigned</label>
                                <select class="form-control" name="ID_User">
                                    @if (ViewBag.rol == "Agent")
                                    {
                                        foreach (var item in agents)
                                        {
                                            <option value="@item.ID_User">@item.Name @item.LastName</option>
                                        }
                                    }
                                    else
                                    {
                                        <option value="-1">...</option>
                                        foreach (var item in agents)
                                        {
                                            <option value="@item.ID_User">@item.Name @item.LastName</option>
                                        }
                                    }

                                </select>
                            </div>
                            <br />
                        </div>
                        <br />
                        <br />
                        <div class="row">
                            <div class="col-md-12 text-align-center">
                                <div class="form-group">
                                    <input type="submit" value="Add Customer" class="btn btn-default" />
                                </div>
                            </div>
                        </div>

                    </div>
                }





            </div>
            <!-- End Calendar -->
        </div>
        <!-- End Widget -->



    </div>

</div>
<!-- End Container -->
<div class="modal" id="sourceModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add source</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="closeButton">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Source name:</label>
                    <input type="text" class="form-control" id="sourceName" required />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="buttonNewSource">Save</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="mstatusModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Marital Status</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="closeButtonStatus">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Status name:</label>
                    <input type="text" class="form-control" id="statusName" required />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="buttonNewStatus">Save</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    document.getElementById("buttonNewSource").onclick = function () {
        var sourceName = $("#sourceName").val();

        sourceName = sourceName.toUpperCase();

        $.ajax({
            type: "POST",
            url: '@Url.Action("CreateSource","Tb_Source")',
            contentType: 'application/json',
            data: JSON.stringify({
                source: sourceName
            }),
            success: function (response) {
                $('#selectSource').append($('<option>', {

                    value: sourceName,
                    text: sourceName
                }));
                var closeModal = $('#closeButton');
                closeModal.trigger('click');
                $('#sourceName').val('');
                new Noty({
                    type: 'success',
                    layout: 'topRight',
                    text: 'Information added successfully',
                    progressBar: true,
                    timeout: 2500
                }).show()
            },
            error: function (error) {

                alert("Error" + error + " " + response);
                var closeModal = $('#closeButton');
                closeModal.trigger('click');
            }
        });
    }
        document.getElementById("buttonNewStatus").onclick = function () {
        var statusName = $("#statusName").val();

        statusName = statusName.toUpperCase();

        $.ajax({
            type: "POST",
            url: '@Url.Action("CreateStatus", "Tb_Status")',
            contentType: 'application/json',
            data: JSON.stringify({
                mstatus: statusName
            }),
            success: function (response) {
                $('#Marital_status').append($('<option>', {

                    value: statusName,
                    text: statusName
                }));
                var closeModal = $('#closeButtonStatus');
                closeModal.trigger('click');
                $('#statusName').val('');
               
                new Noty({
                    type: 'success',
                    layout: 'topRight',
                    text: 'Information added successfully',
                    progressBar: true,
                    timeout: 2500
                }).show()
            },
            error: function (error) {

                alert("Error" + error + " " + response);
                var closeModal = $('#closeButton');
                closeModal.trigger('click');
            }
        });
    }
</script>